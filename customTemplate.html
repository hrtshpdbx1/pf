<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Système de Personnalisation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Variables CSS pour la personnalisation */
    :root {
      --main-background: white;
      --main-text: black;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: var(--main-background);
      color: var(--main-text);
      font-family: 'Montserrat', Arial, sans-serif;
      transition: all 0.3s ease;
    }

    /* Skip link pour navigation clavier */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: #000;
      color: #fff;
      padding: 8px;
      text-decoration: none;
      z-index: 10000;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Classes de typographies */
    body.arial { font-family: Arial, sans-serif; }
    body.times { font-family: 'Times New Roman', serif; }
    body.montserrat { font-family: 'Montserrat', sans-serif; }
    body.georgia { font-family: Georgia, serif; }
    body.verdana { font-family: Verdana, sans-serif; }

    /* Menu latéral de personnalisation */
    #sidebar {
      position: fixed;
      right: -400px;
      top: 0;
      width: 350px;
      height: 100vh;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: -2px 0 10px rgba(0,0,0,0.1);
      padding: 2em;
      transition: right 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }

    #sidebar.sticky {
      right: 0;
    }

    /* Focus visible pour navigation clavier */
    *:focus-visible {
      outline: 3px solid #0066cc;
      outline-offset: 2px;
    }

    .customBlock {
      margin-bottom: 2em;
      padding-bottom: 1em;
      border-bottom: 1px solid #ddd;
    }

    .trigger-gestion {
      font-weight: 600;
      margin-bottom: 0.5em;
      text-transform: uppercase;
      font-size: 0.9em;
      color: #666;
    }

    .gestion {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5em;
      margin-top: 0.5em;
    }

    /* Boutons de contrôle - utilisent <button> pour accessibilité */
    button.bouton-gestion-taille,
    button.bouton-gestion-alignement,
    button.bouton-gestion-typo,
    button.bouton-gestion-contrastes,
    button.bouton-gestion-block {
      padding: 0.5em 1em;
      background: #f0f0f0;
      border: 2px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1em;
      color: var(--main-text);
    }

    button:hover {
      background: #e0e0e0;
      border-color: #999;
    }

    button.customSelected {
      background: #333 !important;
      color: white !important;
      border-color: #333 !important;
    }

    /* Indication ARIA pour état sélectionné */
    button[aria-pressed="true"] {
      background: #333;
      color: white;
      border-color: #333;
    }

    /* Bouton trigger menu */
    #logo_trigger_menu {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: #333;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 999;
      color: white;
      font-size: 1.5em;
    }

    #closeCustomBlock {
      background: #333;
      color: white;
      padding: 1em;
      text-align: center;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      margin-bottom: 1em;
      width: 100%;
      font-size: 1em;
    }

    /* Prompt d'affichage des valeurs */
    .prompt {
      display: inline-block;
      font-weight: bold;
      color: #333;
    }

    /* Gammes de contrastes */
    button.bouton-gestion-contrastes {
      width: 40px;
      height: 40px;
      padding: 0;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Styles des gammes de couleurs */
    #gamme01 { background: #ffffff; color: #000000; border-color: #000000; }
    #gamme02 { background: #000000; color: #ffffff; }
    #gamme03 { background: #2F2F2F; color: #F6F6F6; }
    #gamme04 { background: #F6F6F6; color: #2F2F2F; border-color: #2F2F2F; }
    #gamme05 { background: #d1b0b3; color: #2d0060; }
    #gamme06 { background: #ffbf6e; color: #9161f2; }

    /* Zone de contenu */
    #wrapper {
      padding: 2em;
      max-width: 1200px;
      margin: 0 auto;
      font-size: 22px;
      line-height: 1.2;
      text-align: left;
    }

    /* Mode bloc de contraste */
    #wrapper.block p,
    #wrapper.block h1,
    #wrapper.block h2,
    #wrapper.block h3 {
      background: var(--main-text);
      color: var(--main-background);
      padding: 0.5em;
      margin-bottom: 0.5em;
    }

    h1 { font-size: 2em; margin-bottom: 0.5em; }
    h2 { font-size: 1.5em; margin-bottom: 0.5em; }
    h3 { font-size: 1.2em; margin-bottom: 0.5em; }
    p { margin-bottom: 1em; }

    /* Groupe de boutons pour navigation clavier */
    .gestion[role="group"] {
      border: 1px solid #ddd;
      padding: 0.5em;
      border-radius: 5px;
    }

    /* Annonce live pour lecteurs d'écran */
    .sr-only {
      position: absolute;
      left: -10000px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }

    [aria-live] {
      position: absolute;
      left: -10000px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <!-- Skip link -->
  <a href="#main-content" class="skip-link">Aller au contenu principal</a>

  <!-- Annonces pour lecteurs d'écran -->
  <div id="announcements" aria-live="polite" aria-atomic="true"></div>

  <!-- Bouton trigger menu -->
  <button id="logo_trigger_menu" 
          aria-label="Ouvrir le menu de personnalisation" 
          aria-expanded="false"
          aria-controls="sidebar">
    ⚙
  </button>

  <!-- Menu latéral -->
  <aside id="sidebar" role="region" aria-label="Panneau de personnalisation">
    <button id="closeCustomBlock" aria-label="Fermer le menu de personnalisation">
      Masquer les outils
    </button>

    <!-- Contrôle de la police -->
    <div class="customBlock">
      <div class="trigger-gestion" id="font-label">Police : <span class="visio-typo prompt" aria-live="polite">Montserrat</span></div>
      <div class="gestion" role="group" aria-labelledby="font-label">
        <button class="bouton-gestion-typo arial" 
                data-font="arial" 
                aria-pressed="false"
                aria-label="Police Arial">
          Arial
        </button>
        <button class="bouton-gestion-typo times" 
                data-font="times" 
                aria-pressed="false"
                aria-label="Police Times New Roman">
          Times
        </button>
        <button class="bouton-gestion-typo montserrat customSelected" 
                data-font="montserrat" 
                aria-pressed="true"
                aria-label="Police Montserrat">
          Montserrat
        </button>
        <button class="bouton-gestion-typo georgia" 
                data-font="georgia" 
                aria-pressed="false"
                aria-label="Police Georgia">
          Georgia
        </button>
        <button class="bouton-gestion-typo verdana" 
                data-font="verdana" 
                aria-pressed="false"
                aria-label="Police Verdana">
          Verdana
        </button>
      </div>
    </div>

    <!-- Contrôle de la taille -->
    <div class="customBlock">
      <div class="trigger-gestion" id="size-label">Taille : <span id="taillePrompt" class="prompt" aria-live="polite">22</span>px</div>
      <div class="gestion" role="group" aria-labelledby="size-label">
        <button class="bouton-gestion-taille moins" 
                data-change="-3"
                aria-label="Diminuer la taille du texte">
          -
        </button>
        <button class="bouton-gestion-taille plus" 
                data-change="3"
                aria-label="Augmenter la taille du texte">
          +
        </button>
      </div>
    </div>

    <!-- Contrôle de l'interlignage -->
    <div class="customBlock">
      <div class="trigger-gestion" id="line-label">Interlignage : <span id="interlignagePrompt" class="prompt" aria-live="polite">1.2</span></div>
      <div class="gestion" role="group" aria-labelledby="line-label">
        <button class="bouton-gestion-taille moins" 
                data-inter="-0.1"
                aria-label="Diminuer l'interlignage">
          -
        </button>
        <button class="bouton-gestion-taille plus" 
                data-inter="0.1"
                aria-label="Augmenter l'interlignage">
          +
        </button>
      </div>
    </div>

    <!-- Contrôle de l'alignement -->
    <div class="customBlock">
      <div class="trigger-gestion" id="align-label">Alignement :</div>
      <div class="gestion" role="group" aria-labelledby="align-label">
        <button class="bouton-gestion-alignement left customSelected" 
                data-align="left"
                aria-pressed="true"
                aria-label="Aligner le texte à gauche">
          Gauche
        </button>
        <button class="bouton-gestion-alignement center" 
                data-align="center"
                aria-pressed="false"
                aria-label="Centrer le texte">
          Centre
        </button>
        <button class="bouton-gestion-alignement justify" 
                data-align="justify"
                aria-pressed="false"
                aria-label="Justifier le texte">
          Justifier
        </button>
      </div>
    </div>

    <!-- Contrôle des contrastes -->
    <div class="customBlock">
      <div class="trigger-gestion" id="contrast-label">Contraste :</div>
      <div class="gestion" role="group" aria-labelledby="contrast-label">
        <button id="gamme01" 
                class="bouton-gestion-contrastes" 
                data-bg="#ffffff" 
                data-text="#000000"
                aria-label="Contraste : texte noir sur fond blanc">
          •
        </button>
        <button id="gamme02" 
                class="bouton-gestion-contrastes" 
                data-bg="#000000" 
                data-text="#ffffff"
                aria-label="Contraste : texte blanc sur fond noir">
          •
        </button>
        <button id="gamme03" 
                class="bouton-gestion-contrastes" 
                data-bg="#2F2F2F" 
                data-text="#F6F6F6"
                aria-label="Contraste : texte gris clair sur fond gris foncé">
          •
        </button>
        <button id="gamme04" 
                class="bouton-gestion-contrastes" 
                data-bg="#F6F6F6" 
                data-text="#2F2F2F"
                aria-label="Contraste : texte gris foncé sur fond gris clair">
          •
        </button>
        <button id="gamme05" 
                class="bouton-gestion-contrastes" 
                data-bg="#d1b0b3" 
                data-text="#2d0060"
                aria-label="Contraste : texte violet foncé sur fond rose">
          •
        </button>
        <button id="gamme06" 
                class="bouton-gestion-contrastes" 
                data-bg="#ffbf6e" 
                data-text="#9161f2"
                aria-label="Contraste : texte violet sur fond orange">
          •
        </button>
      </div>
      <div class="gestion" style="margin-top: 1em;" role="group" aria-label="Mode fond coloré">
        <button class="bouton-gestion-block avec" 
                data-block="1"
                aria-pressed="false"
                aria-label="Activer le fond coloré des paragraphes">
          Fond activé
        </button>
        <button class="bouton-gestion-block sans customSelected" 
                data-block="0"
                aria-pressed="true"
                aria-label="Désactiver le fond coloré des paragraphes">
          Fond désactivé
        </button>
      </div>
    </div>
  </aside>

  <!-- Contenu principal -->
  <main id="main-content">
    <div id="wrapper">
      <h1>Système de Personnalisation Accessible</h1>
      <p>Ce système permet de personnaliser l'apparence de la page selon vos besoins en accessibilité.</p>
      
      <h2>Fonctionnalités disponibles</h2>
      <p>Vous pouvez modifier la police, la taille du texte, l'interlignage, l'alignement et les contrastes de couleurs.</p>
      
      <h3>Navigation clavier</h3>
      <p>Utilisez la touche <kbd>Tab</kbd> pour naviguer entre les contrôles, <kbd>Espace</kbd> ou <kbd>Entrée</kbd> pour activer un bouton.</p>
      
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
    </div>
  </main>

  <script>
    // Variables globales pour stocker les préférences
    let fontSize = 22;
    let lineHeight = 1.2;
    let textAlign = 'left';
    let bgColor = '#ffffff';
    let textColor = '#000000';
    let fontType = 'montserrat';
    let blockMode = 0;

    // Fonction pour annoncer les changements aux lecteurs d'écran
    function announce(message) {
      const announcer = document.getElementById('announcements');
      announcer.textContent = message;
      setTimeout(() => {
        announcer.textContent = '';
      }, 1000);
    }

    // Fonction pour sauvegarder dans localStorage
    function savePreference(key, value) {
      localStorage.setItem(key, value);
    }

    // Fonction pour charger depuis localStorage
    function loadPreference(key, defaultValue) {
      const value = localStorage.getItem(key);
      return value !== null ? value : defaultValue;
    }

    // Chargement des préférences au démarrage
    function loadAllPreferences() {
      fontSize = parseInt(loadPreference('fontSize', '22'));
      lineHeight = parseFloat(loadPreference('lineHeight', '1.2'));
      textAlign = loadPreference('textAlign', 'left');
      bgColor = loadPreference('bgColor', '#ffffff');
      textColor = loadPreference('textColor', '#000000');
      fontType = loadPreference('fontType', 'montserrat');
      blockMode = parseInt(loadPreference('blockMode', '0'));

      applyAllStyles();
    }

    // Application de tous les styles
    function applyAllStyles() {
      const wrapper = document.getElementById('wrapper');
      const root = document.documentElement;
      
      wrapper.style.fontSize = fontSize + 'px';
      wrapper.style.lineHeight = lineHeight;
      wrapper.style.textAlign = textAlign;
      
      root.style.setProperty('--main-background', bgColor);
      root.style.setProperty('--main-text', textColor);
      
      // Appliquer la police
      document.body.className = document.body.className.replace(/\barial\b|\btimes\b|\bmontserrat\b|\bgeorgia\b|\bverdana\b/g, '');
      document.body.classList.add(fontType);
      
      // Appliquer le mode bloc
      if (blockMode > 0) {
        wrapper.classList.add('block');
      } else {
        wrapper.classList.remove('block');
      }
      
      // Mise à jour des prompts
      document.getElementById('taillePrompt').textContent = fontSize;
      document.getElementById('interlignagePrompt').textContent = lineHeight.toFixed(1);
      document.querySelector('.visio-typo').textContent = fontType;
      
      // Mise à jour des boutons sélectionnés
      updateSelectedButtons();
    }

    // Mise à jour visuelle des boutons sélectionnés avec ARIA
    function updateSelectedButtons() {
      // Alignement
      document.querySelectorAll('.bouton-gestion-alignement').forEach(btn => {
        const isSelected = btn.dataset.align === textAlign;
        btn.classList.toggle('customSelected', isSelected);
        btn.setAttribute('aria-pressed', isSelected);
      });
      
      // Police
      document.querySelectorAll('.bouton-gestion-typo').forEach(btn => {
        const isSelected = btn.dataset.font === fontType;
        btn.classList.toggle('customSelected', isSelected);
        btn.setAttribute('aria-pressed', isSelected);
      });
      
      // Mode bloc
      document.querySelectorAll('.bouton-gestion-block').forEach(btn => {
        const isSelected = parseInt(btn.dataset.block) === blockMode;
        btn.classList.toggle('customSelected', isSelected);
        btn.setAttribute('aria-pressed', isSelected);
      });
    }

    // Gestion du changement de taille
    document.querySelectorAll('.bouton-gestion-taille').forEach(btn => {
      btn.addEventListener('click', function() {
        if (this.dataset.change) {
          const change = parseInt(this.dataset.change);
          fontSize += change;
          fontSize = Math.max(14, Math.min(38, fontSize));
          savePreference('fontSize', fontSize);
          applyAllStyles();
          announce(`Taille du texte : ${fontSize} pixels`);
        }
        if (this.dataset.inter) {
          const change = parseFloat(this.dataset.inter);
          lineHeight += change;
          lineHeight = Math.max(1.0, Math.min(2.5, lineHeight));
          savePreference('lineHeight', lineHeight.toFixed(1));
          applyAllStyles();
          announce(`Interlignage : ${lineHeight.toFixed(1)}`);
        }
      });
    });

    // Gestion du changement d'alignement
    document.querySelectorAll('.bouton-gestion-alignement').forEach(btn => {
      btn.addEventListener('click', function() {
        textAlign = this.dataset.align;
        savePreference('textAlign', textAlign);
        applyAllStyles();
        const alignText = textAlign === 'left' ? 'gauche' : textAlign === 'center' ? 'centré' : 'justifié';
        announce(`Texte aligné à ${alignText}`);
      });
    });

    // Gestion du changement de police
    document.querySelectorAll('.bouton-gestion-typo').forEach(btn => {
      btn.addEventListener('click', function() {
        fontType = this.dataset.font;
        savePreference('fontType', fontType);
        applyAllStyles();
        announce(`Police changée : ${fontType}`);
      });
    });

    // Gestion du changement de contraste
    document.querySelectorAll('.bouton-gestion-contrastes').forEach(btn => {
      btn.addEventListener('click', function() {
        bgColor = this.dataset.bg;
        textColor = this.dataset.text;
        savePreference('bgColor', bgColor);
        savePreference('textColor', textColor);
        applyAllStyles();
        announce('Contraste modifié');
      });
    });

    // Gestion du mode bloc
    document.querySelectorAll('.bouton-gestion-block').forEach(btn => {
      btn.addEventListener('click', function() {
        blockMode = parseInt(this.dataset.block);
        savePreference('blockMode', blockMode);
        applyAllStyles();
        announce(blockMode > 0 ? 'Fond des paragraphes activé' : 'Fond des paragraphes désactivé');
      });
    });

    // Toggle du menu avec gestion ARIA
    const triggerBtn = document.getElementById('logo_trigger_menu');
    const sidebar = document.getElementById('sidebar');
    
    triggerBtn.addEventListener('click', toggleMenu);
    
    function toggleMenu() {
      const isOpen = sidebar.classList.toggle('sticky');
      triggerBtn.setAttribute('aria-expanded', isOpen);
      triggerBtn.setAttribute('aria-label', isOpen ? 'Fermer le menu de personnalisation' : 'Ouvrir le menu de personnalisation');
      
      // Focus sur le bouton de fermeture quand le menu s'ouvre
      if (isOpen) {
        document.getElementById('closeCustomBlock').focus();
      }
    }

    document.getElementById('closeCustomBlock').addEventListener('click', function() {
      sidebar.classList.remove('sticky');
      triggerBtn.setAttribute('aria-expanded', 'false');
      triggerBtn.setAttribute('aria-label', 'Ouvrir le menu de personnalisation');
      triggerBtn.focus(); // Retour focus sur le bouton d'ouverture
    });

    // Fermer avec Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && sidebar.classList.contains('sticky')) {
        sidebar.classList.remove('sticky');
        triggerBtn.setAttribute('aria-expanded', 'false');
        triggerBtn.setAttribute('aria-label', 'Ouvrir le menu de personnalisation');
        triggerBtn.focus();
      }
    });

    // Piège de focus dans le menu
    sidebar.addEventListener('keydown', function(e) {
      if (e.key === 'Tab' && sidebar.classList.contains('sticky')) {
        const focusableElements = sidebar.querySelectorAll('button:not([disabled])');
        const firstElement = focusableElements[0];
        const lastElement = focusableElements[focusableElements.length - 1];

        if (e.shiftKey && document.activeElement === firstElement) {
          e.preventDefault();
          lastElement.focus();
        } else if (!e.shiftKey && document.activeElement === lastElement) {
          e.preventDefault();
          firstElement.focus();
        }
      }
    });

    // Charger les préférences au démarrage
    loadAllPreferences();
  </script>
</body>
</html>